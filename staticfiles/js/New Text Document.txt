document.addEventListener("DOMContentLoaded", () => {
  const slides = document.querySelectorAll(".status-slide");
  const bars = document.querySelectorAll(".progress-fill");

  let current = 0;
  let duration = 5000; // 5 seconds per status
  let timer;

  function showSlide(index) {
    slides.forEach(s => s.classList.remove("active"));
    bars.forEach(b => (b.style.width = "0%"));

    slides[index].classList.add("active");

    animateBar(index);
    playMedia(index);
  }

  function animateBar(index) {
    let start = null;

    function step(timestamp) {
      if (!start) start = timestamp;
      const progress = timestamp - start;
      const percent = Math.min((progress / duration) * 100, 100);
      bars[index].style.width = percent + "%";

      if (progress < duration) {
        requestAnimationFrame(step);
      } else {
        next();
      }
    }

    requestAnimationFrame(step);
  }

  function playMedia(index) {
    const video = slides[index].querySelector("video");
    if (video) {
      video.currentTime = 0;
      video.play();
      duration = video.duration * 1000 || 5000;
    } else {
      duration = 5000;
    }
  }

  function next() {
    if (current < slides.length - 1) {
      current++;
      showSlide(current);
    }
  }

  showSlide(current);
});
